name: Code scanning alerts bulk dismissal

on: [push, workflow_dispatch]

jobs:
  create-project: 
    runs-on: ubuntu-latest
    env:
      # Settings
      OWNER: AleksIvanovSinglet # verbatim from URL
      PROJECT_NAME: Notepads # verbatim from URL
      ACCESS_TOKEN: ${{ secrets.CSA_ACCESS_TOKEN }} # requires security_events read/write permissions
      DISMISS_REASON: false positive # "false positive", "won't fix" or "used in tests". 
    steps:
      - name: Install jq
        id: install_jq
        uses: sergeysova@jq-action@v2

      - name: Check jq
        run: jq --version

      # - name: Run automation
      #   id: run_automation
      #   shell: bash
      #   run: |
      #     RESULT=$(curl -u $OWNER:$ACCESS_TOKEN -H "Accept: application/vnd.github.v3+json" https://api.github.com/repos/$OWNER/$PROJECT_NAME/code-scanning/alerts?state=open | jq '.[].number')

      #     while [ -n "$RESULT" ]
      #     do
      #       for index in $RESULT
      #       do
      #         ALERT_URL="https://api.github.com/repos/$OWNER/$PROJECT_NAME/code-scanning/alerts/$index"

      #         curl -u $OWNER:$ACCESS_TOKEN -X PATCH -H "Accept: application/vnd.github.v3+json" $ALERT_URL -d '{"state":"dismissed","dismissed_reason":"'"$DISMISS_REASON"'"}'
      #       done

      #       RESULT=$(curl -u $OWNER:$ACCESS_TOKEN -H "Accept: application/vnd.github.v3+json" https://api.github.com/repos/$OWNER/$PROJECT_NAME/code-scanning/alerts?state=open | jq '.[].number')
      #     done

# Built with ‚ù§ by [Pipeline Foundation](http://pipeline.foundation)